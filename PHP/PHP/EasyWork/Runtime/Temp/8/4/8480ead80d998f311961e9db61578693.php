<?php
//000000000000s:4856:"SELECT SQL_CALC_FOUND_ROWS t1.id as id,t1.title as t1_old_title,t1.code as t1_old_code,t1.views as t1_old_views,t2.startdate as t2_old_o_startdate,t2.enddate as t2_old_o_enddate,IF(( SELECT MIN(tt2.startdate) FROM dwin_task_table as tt2 WHERE ( tt2.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),( SELECT MIN(tt2.startdate) FROM dwin_task_table as tt2 WHERE ( tt2.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),t2.startdate) as t2_old_startdate,IF(( SELECT MAX(tt3.enddate) FROM dwin_task_table as tt3 WHERE ( tt3.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),( SELECT MAX(tt3.enddate) FROM dwin_task_table as tt3 WHERE ( tt3.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),t2.enddate) as t2_old_enddate,t1.pm_id as t1_old_pm_id,t3.username as t3_old_username,t1.client_id as client_id,t1.uptime as t1_old_uptime,concat_ws(' ',date_format(( SELECT MIN(tt2.startdate) FROM dwin_task_table as tt2 WHERE ( tt2.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),'%Y-%m')) as mindate,(date_format(( SELECT MAX(tt3.enddate) FROM dwin_task_table as tt3 WHERE ( tt3.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),'%Y-%m')) as maxdate,(date_format(( SELECT MIN(tt6.addtime) FROM dwin_worklog_table as tt6 WHERE ( tt6.task_id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),'%Y-%m')) as minrdate,(date_format(( SELECT MAX(tt7.addtime) FROM dwin_worklog_table as tt7 WHERE ( tt7.task_id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  ),'%Y-%m')) as maxrdate,round(( SELECT count(tt4.id) as comple FROM dwin_task_table as tt4 WHERE ( tt4.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt4.status=51 )  )/( SELECT count(tt5.id) as total FROM dwin_task_main_table as tt5 WHERE ( tt5.pro_id=t1.id )  )*100,0) as t1_old_comple,IF(t1.status>0,t4.val,CASE WHEN round(( SELECT count(tt4.id) as comple FROM dwin_task_table as tt4 WHERE ( tt4.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt4.status=51 )  )/( SELECT count(tt5.id) as total FROM dwin_task_main_table as tt5 WHERE ( tt5.pro_id=t1.id )  )*100,0)=100 THEN '<div style="background-color: #83a6fe; width:100%; text-align:center;">已完成</div>' WHEN ( SELECT count(tt5.id) as ing FROM dwin_task_table as tt5 WHERE ( tt5.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt5.status>9 )  )=0 THEN '<div style="background-color: #cf86cf; width:100%; text-align:center;">待进行</div>' WHEN TO_DAYS(NOW())>TO_DAYS(( SELECT MAX(tt3.enddate) FROM dwin_task_table as tt3 WHERE ( tt3.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) )  )) THEN '<div style="background-color: #FE4B3D; width:100%; text-align:center;">延误</div>' ELSE '<div style="background-color: #3DFE42; width:100%; text-align:center;">进行中</div>' END) as t1_new_pass,IF(t1.status>0,t4.sort,CASE WHEN round(( SELECT count(tt4.id) as comple FROM dwin_task_table as tt4 WHERE ( tt4.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt4.status=51 )  )/( SELECT count(tt5.id) as total FROM dwin_task_main_table as tt5 WHERE ( tt5.pro_id=t1.id )  )*100,0)=100 THEN 4 WHEN ( SELECT count(tt5.id) as ing FROM dwin_task_table as tt5 WHERE ( tt5.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt5.status>9 )  )=0 THEN 1 WHEN TO_DAYS(NOW())>TO_DAYS(t2.enddate) THEN 3 ELSE 2 END) as t1_old_pass,CASE WHEN round(( SELECT count(tt4.id) as comple FROM dwin_task_table as tt4 WHERE ( tt4.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt4.status=51 )  )/( SELECT count(tt5.id) as total FROM dwin_task_main_table as tt5 WHERE ( tt5.pro_id=t1.id )  )*100,0)=100 THEN 1 WHEN ( SELECT count(tt5.id) as ing FROM dwin_task_table as tt5 WHERE ( tt5.id IN(( SELECT tt1.task_id as id FROM dwin_task_main_table as tt1 WHERE ( tt1.pro_id=t1.id )  )) and tt5.status>9 )  )=0 THEN 2 WHEN TO_DAYS(NOW())>TO_DAYS(t2.enddate) THEN 3 ELSE 4 END as t1_old_passnum FROM dwin_project_table as t1 LEFT JOIN  dwin_project_baseinfo_table as t2 on t2.pro_id = t1.id LEFT JOIN  dwin_user_table as t3 on t3.id = t1.pm_id LEFT JOIN  dwin_linkage as t4 on t4.id = t1.status HAVING id>0  and t1_old_title like '%aa%'  and t1_old_pm_id=1 ORDER BY t1_old_pass asc,t1_old_uptime desc LIMIT 0,50  ";
?>